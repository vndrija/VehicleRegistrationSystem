<div class="space-y-5">
  <div class="bg-white border border-gray-200 rounded-lg shadow-sm overflow-hidden">
    <div class="px-5 py-3 bg-[#C6363C] flex items-center justify-between">
      <div class="flex items-center gap-2 text-white">
        <i class="pi pi-car text-sm"></i>
        <h2 class="text-base font-semibold">Евиденција украдених возила</h2>
      </div>
      @if (!isStolenLoading()) {
        <span class="text-xs bg-white/20 text-white rounded-full px-2.5 py-0.5 font-medium">
          {{ stolenVehicles().length }} возила
        </span>
      }
    </div>
    <div class="px-5 py-5">
      @if (isStolenLoading()) {
        <div class="flex items-center gap-2 text-sm text-gray-400 py-6 justify-center">
          <i class="pi pi-spin pi-spinner"></i> Учитавање...
        </div>
      } @else if (stolenVehicles().length === 0) {
        <div class="py-10 text-center">
          <i class="pi pi-check-circle text-green-400 text-3xl mb-3 block"></i>
          <p class="text-sm text-gray-500">Тренутно нема украдених возила у евиденцији.</p>
        </div>
      } @else {
        <div class="overflow-x-auto">
          <table class="w-full text-sm">
            <thead>
              <tr class="bg-[#EEF2F8] text-left">
                <th class="px-3 py-2.5 text-xs font-semibold text-gray-500 uppercase tracking-wide">Регистрација</th>
                <th class="px-3 py-2.5 text-xs font-semibold text-gray-500 uppercase tracking-wide">Опис</th>
                <th class="px-3 py-2.5 text-xs font-semibold text-gray-500 uppercase tracking-wide">Контакт</th>
                <th class="px-3 py-2.5 text-xs font-semibold text-gray-500 uppercase tracking-wide">Датум</th>
                <th class="px-3 py-2.5 text-xs font-semibold text-gray-500 uppercase tracking-wide">Статус</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-gray-100">
              @for (v of stolenVehicles(); track v.ID) {
                <tr class="hover:bg-gray-50 transition-colors">
                  <td class="px-3 py-3 font-mono font-semibold text-gray-900 tracking-wider">{{ v.vehiclePlate }}</td>
                  <td class="px-3 py-3 text-gray-600 text-xs max-w-xs">{{ v.description }}</td>
                  <td class="px-3 py-3 text-gray-600 text-xs">{{ v.contactInfo }}</td>
                  <td class="px-3 py-3 text-gray-400 text-xs whitespace-nowrap">{{ formatDate(v.reportedDate) }}</td>
                  <td class="px-3 py-3">
                    @if (v.status === 'ACTIVE') {
                      <span class="inline-flex items-center gap-1 text-xs font-semibold px-2 py-0.5 rounded-full bg-red-100 text-red-700 border border-red-200">
                        <span class="w-1.5 h-1.5 rounded-full bg-red-500 inline-block"></span> Активно
                      </span>
                    } @else {
                      <span class="inline-flex items-center gap-1 text-xs font-semibold px-2 py-0.5 rounded-full bg-green-100 text-green-700 border border-green-200">
                        <span class="w-1.5 h-1.5 rounded-full bg-green-500 inline-block"></span> Пронађено
                      </span>
                    }
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      }
    </div>
  </div>

  <div class="bg-white border border-gray-200 rounded-lg shadow-sm overflow-hidden">
    <button type="button"
      class="w-full px-5 py-3 bg-[#EEF2F8] border-b border-gray-200 flex items-center justify-between hover:bg-gray-100 transition-colors"
      (click)="toggleReportStolenForm()"
    >
      <div class="flex items-center gap-2 text-gray-700">
        <i class="pi pi-plus-circle text-[#C6363C] text-sm"></i>
        <h2 class="text-base font-semibold">Пријави крађу возила</h2>
      </div>
      <i class="pi text-gray-400 text-sm"
         [class.pi-chevron-down]="!showReportStolenForm()"
         [class.pi-chevron-up]="showReportStolenForm()"></i>
    </button>

    @if (showReportStolenForm()) {
      <div class="px-5 py-5">
        <form [formGroup]="reportStolenForm" (ngSubmit)="reportStolen()" class="space-y-4">
          <div>
            <label class="block text-xs text-gray-500 uppercase tracking-wide mb-1">Регистарска ознака <span class="text-[#C6363C]">*</span></label>
            <input type="text" formControlName="vehiclePlate" placeholder="нпр. BG-123-AB"
              class="w-full border rounded px-3 py-2 text-sm font-mono tracking-wider focus:outline-none focus:ring-1 focus:ring-[#C6363C] focus:border-[#C6363C]"
              [class.border-red-400]="reportStolenForm.get('vehiclePlate')?.invalid && reportStolenForm.get('vehiclePlate')?.touched"
              [class.border-gray-300]="!(reportStolenForm.get('vehiclePlate')?.invalid && reportStolenForm.get('vehiclePlate')?.touched)" />
            @if (reportStolenForm.get('vehiclePlate')?.invalid && reportStolenForm.get('vehiclePlate')?.touched) {
              <p class="text-xs text-red-600 mt-1">Обавезно поље (мин. 3 знака).</p>
            }
          </div>
          <div>
            <label class="block text-xs text-gray-500 uppercase tracking-wide mb-1">Опис <span class="text-[#C6363C]">*</span></label>
            <textarea formControlName="description" rows="3" placeholder="Опишите возило и околности..."
              class="w-full border rounded px-3 py-2 text-sm focus:outline-none focus:ring-1 focus:ring-[#C6363C] focus:border-[#C6363C] resize-none"
              [class.border-red-400]="reportStolenForm.get('description')?.invalid && reportStolenForm.get('description')?.touched"
              [class.border-gray-300]="!(reportStolenForm.get('description')?.invalid && reportStolenForm.get('description')?.touched)"></textarea>
            @if (reportStolenForm.get('description')?.invalid && reportStolenForm.get('description')?.touched) {
              <p class="text-xs text-red-600 mt-1">Обавезно поље (мин. 10 знакова).</p>
            }
          </div>
          <div>
            <label class="block text-xs text-gray-500 uppercase tracking-wide mb-1">Контакт <span class="text-[#C6363C]">*</span></label>
            <input type="text" formControlName="contactInfo" placeholder="Телефон или е-пошта"
              class="w-full border rounded px-3 py-2 text-sm focus:outline-none focus:ring-1 focus:ring-[#C6363C] focus:border-[#C6363C]"
              [class.border-red-400]="reportStolenForm.get('contactInfo')?.invalid && reportStolenForm.get('contactInfo')?.touched"
              [class.border-gray-300]="!(reportStolenForm.get('contactInfo')?.invalid && reportStolenForm.get('contactInfo')?.touched)" />
            @if (reportStolenForm.get('contactInfo')?.invalid && reportStolenForm.get('contactInfo')?.touched) {
              <p class="text-xs text-red-600 mt-1">Обавезно поље (мин. 5 знакова).</p>
            }
          </div>
          @if (reportStolenError()) {
            <div class="flex items-start gap-2 bg-red-50 border-l-4 border-[#C6363C] px-3 py-2 rounded-r">
              <i class="pi pi-exclamation-circle text-[#C6363C] text-sm mt-0.5"></i>
              <span class="text-sm text-red-700">{{ reportStolenError() }}</span>
            </div>
          }
          @if (reportStolenSuccess()) {
            <div class="flex items-start gap-2 bg-green-50 border-l-4 border-green-500 px-3 py-2 rounded-r">
              <i class="pi pi-check-circle text-green-600 text-sm mt-0.5"></i>
              <span class="text-sm text-green-700">{{ reportStolenSuccess() }}</span>
            </div>
          }
          <div class="flex gap-2 pt-1">
            <p-button type="submit" label="Пријави крађу" icon="pi pi-exclamation-triangle" severity="danger" [loading]="isReportingStolenLoading()"></p-button>
            <p-button type="button" label="Откажи" icon="pi pi-times" severity="secondary" (onClick)="toggleReportStolenForm()"></p-button>
          </div>
        </form>
      </div>
    }
  </div>
</div>
