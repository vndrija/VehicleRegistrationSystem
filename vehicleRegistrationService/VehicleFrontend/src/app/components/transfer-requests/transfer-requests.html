<app-navbar></app-navbar>

<p-toast></p-toast>

<!-- Tricolor stripe -->
<div class="flex" style="height: 4px">
  <div class="flex-1 bg-[#C6363C]"></div>
  <div class="flex-1 bg-[#003893]"></div>
  <div class="flex-1 bg-gray-300"></div>
</div>

<!-- Page header -->
<div class="bg-[#003893]">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
    <p class="text-[10px] font-semibold tracking-[0.15em] uppercase text-blue-200 mb-1">
      Министарство унутрашњих послова — Република Србија
    </p>
    <h1 class="text-xl font-bold text-white">Захтеви за пренос возила</h1>
  </div>
</div>

<div class="min-h-screen bg-[#EEF2F8] py-6">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 space-y-6">

    <!-- Pending Received Transfers -->
    <div class="bg-white border border-gray-200 rounded shadow-sm overflow-hidden">
      <div class="bg-[#003893] px-4 py-3 text-white">
        <h2 class="text-base font-semibold">Примљени захтеви</h2>
      </div>

      <div class="p-4">
        @if (isLoadingPending()) {
          <div class="text-center py-8">
            <i class="pi pi-spin pi-spinner text-4xl text-[#003893]"></i>
            <p class="mt-2 text-gray-600">Учитавање захтева...</p>
          </div>
        } @else if (pendingReceivedTransfers().length === 0) {
          <div class="text-center py-8">
            <i class="pi pi-inbox text-5xl text-gray-300 mb-3"></i>
            <p class="text-gray-600">Нема примљених захтева за пренос</p>
          </div>
        } @else {
          <p-table [value]="pendingReceivedTransfers()" [tableStyle]="{ 'min-width': '50rem' }">
            <ng-template pTemplate="header">
              <tr>
                <th>ID</th>
                <th>Возило</th>
                <th>Од корисника</th>
                <th>Датум подношења</th>
                <th class="text-center">Акције</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-transfer>
              <tr>
                <td>{{ transfer.id }}</td>
                <td>
                  <div class="flex flex-col">
                    <span class="font-semibold">{{ transfer.vehicle?.registrationNumber }}</span>
                    <span class="text-sm text-gray-600">
                      {{ transfer.vehicle?.make }} {{ transfer.vehicle?.model }} ({{ transfer.vehicle?.year }})
                    </span>
                  </div>
                </td>
                <td>{{ transfer.fromUserId }}</td>
                <td>{{ formatDateTime(transfer.createdAt) }}</td>
                <td>
                  <div class="flex gap-2 justify-center">
                    <p-button
                      icon="pi pi-check"
                      label="Прихвати"
                      severity="success"
                      size="small"
                      [loading]="isProcessing()"
                      (onClick)="acceptTransfer(transfer)"
                    ></p-button>
                    <p-button
                      icon="pi pi-times"
                      label="Одбиј"
                      severity="danger"
                      size="small"
                      [loading]="isProcessing()"
                      (onClick)="rejectTransfer(transfer)"
                    ></p-button>
                  </div>
                </td>
              </tr>
            </ng-template>
          </p-table>
        }
      </div>
    </div>

    <!-- All My Transfers (History) -->
    <div class="bg-white border border-gray-200 rounded shadow-sm overflow-hidden">
      <div class="bg-[#003893] px-4 py-3 text-white">
        <h2 class="text-base font-semibold">Историја преноса</h2>
      </div>

      <div class="p-4">
        @if (isLoadingAll()) {
          <div class="text-center py-8">
            <i class="pi pi-spin pi-spinner text-4xl text-[#003893]"></i>
            <p class="mt-2 text-gray-600">Учитавање историје...</p>
          </div>
        } @else if (allTransfers().length === 0) {
          <div class="text-center py-8">
            <i class="pi pi-inbox text-5xl text-gray-300 mb-3"></i>
            <p class="text-gray-600">Нема историје преноса</p>
          </div>
        } @else {
          <p-table [value]="allTransfers()" [tableStyle]="{ 'min-width': '60rem' }">
            <ng-template pTemplate="header">
              <tr>
                <th>ID</th>
                <th>Возило</th>
                <th>Од корисника</th>
                <th>За корисника</th>
                <th>Датум подношења</th>
                <th>Статус</th>
                <th>Одговорено</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-transfer>
              <tr>
                <td>{{ transfer.id }}</td>
                <td>
                  <div class="flex flex-col">
                    <span class="font-semibold">{{ transfer.vehicle?.registrationNumber }}</span>
                    <span class="text-sm text-gray-600">
                      {{ transfer.vehicle?.make }} {{ transfer.vehicle?.model }} ({{ transfer.vehicle?.year }})
                    </span>
                  </div>
                </td>
                <td>{{ transfer.fromUserId }}</td>
                <td>{{ transfer.toUserId }}</td>
                <td>{{ formatDateTime(transfer.createdAt) }}</td>
                <td>
                  <p-tag
                    [value]="getStatusLabel(transfer.status)"
                    [severity]="getStatusSeverity(transfer.status)"
                  ></p-tag>
                </td>
                <td>{{ transfer.respondedAt ? formatDateTime(transfer.respondedAt) : '-' }}</td>
              </tr>
            </ng-template>
          </p-table>
        }
      </div>
    </div>

  </div>
</div>
